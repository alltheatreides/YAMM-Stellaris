namespace = bwm_the_conduit

#300 The Conduit
# Code & idea by Frog, writing by Cc

# Early event & project order
#
# 1 -> bwm_CONDUIT_UNLOCK -> 5
#	-> 11 -> bwm_OBELISK_1_PROJECT -> 21 -> 31
#	-> 12 -> bwm_OBELISK_2_PROJECT -> 22 -> 32
#	-> 13 -> bwm_OBELISK_3_PROJECT -> 23 -> 33
#	-> 14 -> bwm_OBELISK_4_PROJECT -> 24 -> 34

#Initial Encounter & First Project Spawn
ship_event = {
	id = bwm_the_conduit.1
	title = "bwm_the_conduit.1"
	desc = "bwm_the_conduit.1.desc"
	picture = GFX_evt_ancient_alien_temple
	show_sound = event_mystic_reveal_light
	location = FROM
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			NOT = {
				has_country_flag = encountered_bwm_conduit
			}
			is_ai = no
		}
		FROM = {
			has_star_flag = bwm_garden_system
			NOT = {
				has_star_flag = bwm_garden_unlock 
			}
		}
	}
	
	immediate = {
		FROM = {
			save_event_target_as = bwm_garden_system 
		}
		owner = {
			set_country_flag = encountered_bwm_conduit
		}
		every_country = {
			if = {
				limit = {
					has_event_chain = "bwm_lex_garden_chain" 
				}
				end_event_chain = "bwm_lex_garden_chain"
			}
		}
	}		
	
	option = {
		name = "bwm_the_conduit.1.a"
		event_target:bwm_shielded_target = {
			enable_special_project = {
				name = "bwm_CONDUIT_UNLOCK"
				location = THIS
				owner = ROOT
			}
		}
	}
}

#Garden Unlock (Planet Access Granted)
ship_event = {
	id = bwm_the_conduit.5
	title = "bwm_the_conduit.5"
	desc = "bwm_the_conduit.5.desc"
	picture = GFX_evt_animal_wildlife
	show_sound = event_mystic_reveal
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_global_flag = bwm_conduit_unlock
		}
	}
	
	immediate = {
		set_global_flag = bwm_conduit_unlock
	}
		
	option = {
		name = "bwm_the_conduit.5.a"
		custom_tooltip = bwm_the_conduit.5.a.tooltip
		hidden_effect = {
			random_system = {
				limit = {
					has_star_flag = bwm_garden_system
				}
				random_system_planet = {
						limit = {
							is_planet_class = pc_shielded
							has_planet_flag = bwm_conduit_shielded
							NOT = {
								has_planet_flag = bwm_conduit_garden 
							}
							solar_system = {
								NOT = {
									has_star_flag = bwm_garden_unlock 
								}
							}
						}
						change_pc = pc_gaia
						set_planet_entity = {
							entity = "gaia_planet_01_entity"
						}
						set_planet_flag = bwm_conduit_garden
						set_planet_flag = fallen_empire_world
						set_planet_flag = colony_event
						
						add_modifier = {
							modifier = "bwm_garden_mod"
							days = -1
						}
						random_tile = {
							limit = { has_blocker = no has_building = no num_adjacent_tiles = 2 }
							set_building = "bwm_building_obelisk_0_1"			
						}
						random_tile = {
							limit = { has_blocker = no has_building = no num_adjacent_tiles = 2 }
							set_building = "bwm_building_obelisk_0_2"		
						}
						random_tile = {
							limit = { has_blocker = no has_building = no num_adjacent_tiles = 2 }
							set_building = "bwm_building_obelisk_0_3"	
						}
						random_tile = {
							limit = { has_building = no has_blocker = no num_adjacent_tiles = 2 }
							set_building = "bwm_building_obelisk_0_4"		
						}
						random_tile = {
							limit = { has_blocker = no has_building = no num_adjacent_tiles > 3 }
							set_building = "bwm_building_ancient_ruin_2"
							add_resource = {
								resource = food
								amount = 1
								replace = yes
							}	
							add_resource = {
								resource = minerals
								amount = 1
							}
							random_neighboring_tile = {
									limit = { has_blocker = no has_building = no }
									set_building = "building_agri_processing_complex"
									add_resource = {
										resource = food
										amount = 1
										replace = yes
								}						
							}
							random_neighboring_tile = {
									limit = { has_blocker = no has_building = no }
									set_building = "building_dark_matter_power_plant"
									add_resource = {
										resource = energy
										amount = 1
										replace = yes
								}						
							}
							random_neighboring_tile = {
									limit = { has_blocker = no has_building = no }
									set_building = "building_dark_matter_power_plant"
									add_resource = {
										resource = energy
										amount = 1
										replace = yes
								}						
							}
							random_neighboring_tile = {
									limit = { has_blocker = no has_building = no }
									set_building = "building_ancient_factory"
									add_resource = {
										resource = minerals
										amount = 1
										replace = yes
								}						
							}				
						}
						random_tile = {
							limit = { has_building = no has_blocker = no }
							set_blocker = tb_ancient_ruins	
							add_resource = {
								resource = engineering_research
								amount = 1
								replace = yes
							}	
						}
						random_tile = {
							limit = { has_building = no has_blocker = no }
							set_blocker = tb_ancient_ruins	
							add_resource = {
								resource = society_research
								amount = 1
								replace = yes
							}	
						}
						random_tile = {
							limit = { has_building = no has_blocker = no }
							set_blocker = tb_ancient_ruins	
							add_resource = {
								resource = physics_research
								amount = 1
								replace = yes
							}	
						}
						random_tile = {
							limit = { has_building = no has_blocker = no }
							set_blocker = tb_ancient_ruins	
							add_resource = {
								resource = sr_betharian
								amount = 1
								replace = yes
							}	
						}
						random_tile = {
							limit = { has_building = no has_blocker = no }
							set_blocker = tb_bwm_paradise	
							add_resource = {
								resource = sr_alien_pets
								amount = 1
								replace = yes
							}	
						}
						random_tile = {
							limit = { has_building = no has_blocker = no }
							set_blocker = tb_bwm_paradise	
							add_resource = {
								resource = engineering_research
								amount = 1
								replace = yes
							}	
						}
						random_tile = {
							limit = { has_building = no has_blocker = no }
							set_blocker = tb_bwm_paradise	
							add_resource = {
								resource = society_research
								amount = 1
								replace = yes
							}							
						}
						random_tile = {
							limit = { has_building = no has_blocker = no }
							set_blocker = tb_bwm_paradise	
							add_resource = {
								resource = physics_research
								amount = 1
								replace = yes
							}		
						}
						random_tile = {
							limit = { has_building = no has_blocker = no }
							set_blocker = tb_bwm_paradise	
							add_resource = {
								resource = food
								amount = 1
								replace = yes
							}		
						}
						random_tile = {
							limit = { has_building = no has_blocker = no }
							set_blocker = tb_bwm_paradise	
							add_resource = {
								resource = energy
								amount = 1
								replace = yes
							}	
						}
						random_tile = {
							limit = { has_building = no has_blocker = no }
							set_blocker = tb_bwm_paradise	
							add_resource = {
								resource = energy
								amount = 1
								replace = yes
							}	
						}
						random_tile = {
							limit = { has_building = no has_blocker = no }
							set_blocker = tb_bwm_paradise	
							add_resource = {
								resource = minerals
								amount = 1
								replace = yes
							}	
						}
						random_tile = {
							limit = { has_building = no has_blocker = no }
							set_blocker = tb_bwm_paradise	
							add_resource = {
								resource = energy
								amount = 2
								replace = yes
							}
							add_resource = {
								resource = food
								amount = 1
							}		
						}
						random_tile = {
							limit = { has_building = no has_blocker = no }
							set_blocker = tb_bwm_paradise	
							add_resource = {
								resource = energy
								amount = 2
								replace = yes
							}
							add_resource = {
								resource = food
								amount = 1
							}	
						}
						random_tile = {
							limit = { has_building = no has_blocker = no }
							set_blocker = tb_bwm_paradise	
							add_resource = {
								resource = minerals
								amount = 2
								replace = yes
							}
							add_resource = {
								resource = food
								amount = 1
							}	
						}
						random_tile = {
							limit = { has_building = no has_blocker = no }
							set_blocker = tb_bwm_paradise	
							add_resource = {
								resource = minerals
								amount = 2
								replace = yes
							}
							add_resource = {
								resource = food
								amount = 1
							}	
						}
				}
				solar_system = {
					set_star_flag = bwm_garden_unlock 
				}
			}
		}
	}
	option = {
		name = "bwm_the_conduit.5.b"
		owner = { 
			add_influence = 100
		}
	}
}

#Conduit Obelisk 1 Init
planet_event = {
	id = bwm_the_conduit.11
	title = "bwm_the_conduit.11"
	desc = "bwm_the_conduit.11.desc"
	picture = GFX_evt_alien_ruins
	location = ROOT

	mean_time_to_happen = {
		years = 5
	}
	
	trigger = {
		exists = owner
		owner = {
			is_ai = no 
		}	
		NOR = {
			has_global_flag = bwm_conduit_eye_appeared
			has_global_flag = bwm_obelisk_1_research_clear
			has_global_flag = bwm_conduit_pillar_1_activated
			has_planet_flag = bwm_conduit_init_1_lock
		}
		has_building = "bwm_building_obelisk_0_1"
		has_planet_flag = bwm_conduit_garden
		has_ground_combat = no
		num_pops > 0
	}
	
	immediate = {
		set_planet_flag = bwm_conduit_init_1_lock
	}

	option = {
		name = bwm_the_conduit.11.a
		enable_special_project = {
			name = "bwm_OBELISK_1_PROJECT"
			location = root
			owner = root
		}
	}
	
	option = {
		name = bwm_the_conduit.11.b
		owner = { 
			add_influence = -100
		}
	}
}

#Conduit Obelisk 2 Init
planet_event = {
	id = bwm_the_conduit.12
	title = "bwm_the_conduit.12"
	desc = "bwm_the_conduit.12.desc"
	picture = GFX_evt_alien_ruins
	location = ROOT

	mean_time_to_happen = {
		years = 5
	}
	
	trigger = {
		exists = owner
		owner = {
			is_ai = no
		}
		NOR = {
			has_global_flag = bwm_conduit_eye_appeared
			has_global_flag = bwm_obelisk_2_research_clear
			has_global_flag = bwm_conduit_pillar_2_activated
			has_planet_flag = bwm_conduit_init_2_lock
		}
		AND = {
			OR = {
				has_global_flag = bwm_obelisk_1_research_clear
				has_global_flag = bwm_conduit_pillar_1_activated
			}
			has_building = "bwm_building_obelisk_0_2"
		}
		has_planet_flag = bwm_conduit_garden
		has_ground_combat = no
		num_pops > 0
	}
	
	immediate = {
		set_planet_flag = bwm_conduit_init_2_lock
	}

	option = {
		name = bwm_the_conduit.12.a
		enable_special_project = {
			name = "bwm_OBELISK_2_PROJECT"
			location = root
			owner = root
		}
	}
	
	option = {
		name = bwm_the_conduit.12.b
		hidden_effect = {
			every_owned_pop = { 
				add_modifier = {
					modifier = "opinion_disrespected"
					days = 360
				}
			}
		}
		owner = { 
			add_influence = -100
		}
	}
}

#Conduit Obelisk 3 Init
planet_event = {
	id = bwm_the_conduit.13
	title = "bwm_the_conduit.13"
	desc = "bwm_the_conduit.13.desc"
	picture = GFX_evt_alien_ruins
	location = ROOT

	mean_time_to_happen = {
		years = 5
	}
	
	trigger = {
		exists = owner
		owner = {
			is_ai = no
		}
		NOR = {
			has_global_flag = bwm_conduit_eye_appeared
			has_global_flag = bwm_obelisk_3_research_clear
			has_global_flag = bwm_conduit_pillar_3_activated
			has_planet_flag = bwm_conduit_init_3_lock
		}
		AND = {
			OR = {
				has_global_flag = bwm_obelisk_1_research_clear
				has_global_flag = bwm_conduit_pillar_1_activated
			}
			OR = {
				has_global_flag = bwm_obelisk_2_research_clear
				has_global_flag = bwm_conduit_pillar_2_activated
			}
			has_building = "bwm_building_obelisk_0_3"
		}
		has_planet_flag = bwm_conduit_garden
		has_ground_combat = no
		num_pops > 0
	}
	
	immediate = {
		set_planet_flag = bwm_conduit_init_3_lock
	}

	option = {
		name = bwm_the_conduit.13.a
		enable_special_project = {
			name = "bwm_OBELISK_3_PROJECT"
			location = root
			owner = root
		}
	}
	
	option = {
		name = bwm_the_conduit.13.b
		hidden_effect = {
			every_owned_pop = { 
				add_modifier = {
					modifier = "opinion_disrespected"
					days = 360
				}
			}
		}
		owner = { 
			add_influence = -100
		}
	}
}

#Conduit Obelisk 4 Init
planet_event = {
	id = bwm_the_conduit.14
	title = "bwm_the_conduit.14"
	desc = "bwm_the_conduit.14.desc"
	picture = GFX_evt_alien_ruins
	location = ROOT

	mean_time_to_happen = {
		years = 5
	}

	trigger = {
		exists = owner
		owner = {
			is_ai = no
		}
		NOR = {
			has_global_flag = bwm_conduit_eye_appeared
			has_global_flag = bwm_obelisk_4_research_clear
			has_global_flag = bwm_conduit_pillar_4_activated
			has_planet_flag = bwm_conduit_init_4_lock
		}
		AND = {
			OR = {
				has_global_flag = bwm_obelisk_1_research_clear
				has_global_flag = bwm_conduit_pillar_1_activated
			}
			OR = {
				has_global_flag = bwm_obelisk_2_research_clear
				has_global_flag = bwm_conduit_pillar_2_activated
			}
			OR = {
				has_global_flag = bwm_obelisk_3_research_clear
				has_global_flag = bwm_conduit_pillar_3_activated
			}
			has_building = "bwm_building_obelisk_0_4"
		}
		has_planet_flag = bwm_conduit_garden
		has_ground_combat = no
		num_pops > 0
	}
	
	immediate = {
		set_planet_flag = bwm_conduit_init_4_lock
	}

	option = {
		name = bwm_the_conduit.14.a
		enable_special_project = {
			name = "bwm_OBELISK_4_PROJECT"
			location = root
			owner = root
		}
	}
	
	option = {
		name = bwm_the_conduit.14.b
		hidden_effect = {
			every_owned_pop = { 
				add_modifier = {
					modifier = "pop_angered"
					days = 360
				}
			}
		}
		owner = { 
			add_influence = -100
		}
	}
}

#Conduit Obelisk 1 Research Complete
planet_event = {
	id = bwm_the_conduit.21
	title = "bwm_the_conduit.21"
	desc = "bwm_the_conduit.21.desc"
	picture = GFX_evt_medieval_alien_civilization
	location = ROOT

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			is_ai = no
		}
		has_planet_flag = bwm_conduit_garden
		has_building = "bwm_building_obelisk_0_1"
		has_ground_combat = no
		num_pops > 0
		NOT = {
			has_global_flag = bwm_obelisk_1_research_clear
		}
	}

	immediate = {
		set_global_flag = bwm_obelisk_1_research_clear
	}

	option = {
		name = EXCELLENT
	}
}

#Conduit Obelisk 2 Research Complete
planet_event = {
	id = bwm_the_conduit.22
	title = "bwm_the_conduit.22"
	desc = "bwm_the_conduit.22.desc"
	picture = GFX_evt_medieval_alien_civilization
	location = ROOT

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			is_ai = no
		}
		has_planet_flag = bwm_conduit_garden
		has_building = "bwm_building_obelisk_0_2"
		has_ground_combat = no
		num_pops > 0
		NOT = {
			has_global_flag = bwm_obelisk_2_research_clear
		}
	}

	immediate = {
		set_global_flag = bwm_obelisk_2_research_clear
	}

	option = {
		name = EXCELLENT
	}
}

#Conduit Obelisk 3 Research Complete
planet_event = {
	id = bwm_the_conduit.23
	title = "bwm_the_conduit.23"
	desc = "bwm_the_conduit.23.desc"
	picture = GFX_evt_medieval_alien_civilization
	location = ROOT

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			is_ai = no
		}
		has_planet_flag = bwm_conduit_garden
		has_building = "bwm_building_obelisk_0_3"	
		has_ground_combat = no
		num_pops > 0
		NOT = {
			has_global_flag = bwm_obelisk_3_research_clear
		}
	}

	immediate = {
		set_global_flag = bwm_obelisk_3_research_clear
	}

	option = {
		name = EXCELLENT
	}
}

#Conduit Obelisk 4 Research Complete
planet_event = {
	id = bwm_the_conduit.24
	title = "bwm_the_conduit.24"
	desc = "bwm_the_conduit.24.desc"
	picture = GFX_evt_medieval_alien_civilization
	location = ROOT

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			is_ai = no
		}
		has_planet_flag = bwm_conduit_garden
		has_building = "bwm_building_obelisk_0_4"
		has_ground_combat = no
		num_pops > 0
		NOT = {
			has_global_flag = bwm_obelisk_4_research_clear
		}
	}

	immediate = {
		set_global_flag = bwm_obelisk_4_research_clear
	}

	option = {
		name = EXCELLENT
	}
}

#Conduit Orbital Obelisk 1
planet_event = {
	id = bwm_the_conduit.31
	title = "bwm_the_conduit.31"
	desc = "bwm_the_conduit.31.desc"
	picture = GFX_evt_psionics
	show_sound = event_mystic_reveal
	location = ROOT
	
	trigger = {
		NOT = {
			has_global_flag = bwm_conduit_pillar_1_activated
			has_global_flag = bwm_conduit_eye_appeared
		}
		from = {
			has_building = bwm_building_obelisk_1
		}
	}
	
	is_triggered_only = yes

	immediate = {
			add_threat = {
			who = owner 
			amount = 5
			}
			add_modifier = {
			modifier = "bwm_obelisk_1_mod"
			days = -1
			}
			every_owned_pop = { 
				add_modifier = {
					modifier = "bwm_pop_conduit_1"
					days = -1
				}
			}	
			solar_system = {
			random_system_ambient_object = {
				limit = { has_ambient_object_flag = bwm_conduit_pillar_1 }
				save_event_target_as = bwm_conduit_pillar_1_target
			}
			create_ambient_object = {
				type = "bwm_conduit_on_object"
			}
			last_created_ambient_object = {
				set_location = event_target:bwm_conduit_pillar_1_target
				set_ambient_object_flag = bwm_conduit_pillar_1_on
			}
			event_target:bwm_conduit_pillar_1_target = {
			destroy_ambient_object = this 
			}
		}
		set_global_flag = bwm_conduit_pillar_1_activated
	}
	
	option = {
		name = bwm_the_conduit.31.a
	}
}

#Conduit Orbital Obelisk 2
planet_event = {
	id = bwm_the_conduit.32
	title = "bwm_the_conduit.32"
	desc = "bwm_the_conduit.32.desc"
	picture = GFX_evt_psionics
	show_sound = event_mystic_reveal
	location = ROOT
	
	trigger = {
		NOT = {
			has_global_flag = bwm_conduit_pillar_2_activated
			has_global_flag = bwm_conduit_eye_appeared
		}
		from = {
			has_building = bwm_building_obelisk_2
		}
	}
	
	is_triggered_only = yes

	immediate = {
			add_threat = {
			who = owner 
			amount = 5
			}
			add_modifier = {
			modifier = "bwm_obelisk_2_mod"
			days = -1
			}
			every_owned_pop = { 
				add_modifier = {
					modifier = "bwm_pop_conduit_2"
					days = -1
				}
			}
			solar_system = {
			random_system_ambient_object = {
				limit = { has_ambient_object_flag = bwm_conduit_pillar_2 }
				save_event_target_as = bwm_conduit_pillar_2_target
			}
			create_ambient_object = {
				type = "bwm_conduit_on_object"
			}
			last_created_ambient_object = {
				set_location = event_target:bwm_conduit_pillar_2_target
				set_ambient_object_flag = bwm_conduit_pillar_2_on
			}
			event_target:bwm_conduit_pillar_2_target = {
			destroy_ambient_object = this 
			}
		}
		set_global_flag = bwm_conduit_pillar_2_activated
	}
	
	option = {
		name = bwm_the_conduit.32.a
	}
}

#Conduit Orbital Obelisk 3
planet_event = {
	id = bwm_the_conduit.33
	title = "bwm_the_conduit.33"
	desc = "bwm_the_conduit.33.desc"
	picture = GFX_evt_psionics
	show_sound = event_mystic_reveal
	location = ROOT
	
	trigger = {
		NOT = {
			has_global_flag = bwm_conduit_eye_appeared
			has_global_flag = bwm_conduit_pillar_3_activated
		}
		from = {
			has_building = bwm_building_obelisk_3
		}
	}
	
	is_triggered_only = yes

	immediate = {
		add_threat = {
		who = owner 
		amount = 5
		}
		add_modifier = {
		modifier = "bwm_obelisk_3_mod"
		days = -1
		}
		every_owned_pop = { 
			add_modifier = {
				modifier = "bwm_pop_conduit_3"
				days = -1
			}
		}
		solar_system = {
			random_system_ambient_object = {
				limit = { has_ambient_object_flag = bwm_conduit_pillar_3 }
				save_event_target_as = bwm_conduit_pillar_3_target
			}
			create_ambient_object = {
				type = "bwm_conduit_on_object"
			}
			last_created_ambient_object = {
				set_location = event_target:bwm_conduit_pillar_3_target
				set_ambient_object_flag = bwm_conduit_pillar_3_on
			}
			event_target:bwm_conduit_pillar_3_target = {
			destroy_ambient_object = this 
			}	
		}
		set_global_flag = bwm_conduit_pillar_3_activated
	}
	
	option = {
		name = bwm_the_conduit.33.a
	}
}

#Conduit Orbital Obelisk 4
planet_event = {
	id = bwm_the_conduit.34
	title = "bwm_the_conduit.34"
	desc = "bwm_the_conduit.34.desc"
	picture = GFX_evt_psionics
	show_sound = event_mystic_reveal
	location = ROOT
	
	trigger = {
		NOT = {
			has_global_flag = bwm_conduit_eye_appeared
			has_global_flag = bwm_conduit_pillar_4_activated
		}
		from = {
			has_building = bwm_building_obelisk_4
		}
	}
	
	is_triggered_only = yes

	immediate = {
			add_threat = {
			who = owner 
			amount = 5
			}
			add_modifier = {
			modifier = "bwm_obelisk_4_mod"
			days = -1
			}
			every_owned_pop = { 
				add_modifier = {
					modifier = "bwm_pop_conduit_4"
					days = -1
				}
			}
			solar_system = {
			random_system_ambient_object = {
				limit = { has_ambient_object_flag = bwm_conduit_pillar_4 }
				save_event_target_as = bwm_conduit_pillar_4_target
			}
			create_ambient_object = {
				type = "bwm_conduit_on_object"
			}
			last_created_ambient_object = {
				set_location = event_target:bwm_conduit_pillar_4_target
				set_ambient_object_flag = bwm_conduit_pillar_4_on
			}
			event_target:bwm_conduit_pillar_4_target = {
			destroy_ambient_object = this 
			}
		}
		set_global_flag = bwm_conduit_pillar_4_activated
	}
	
	option = {
		name = bwm_the_conduit.34.a
	}
}

#Conduit Crisis Init
country_event = {
	id = bwm_the_conduit.50
	hide_window = yes
	
	fire_only_once = yes
	
	trigger = {
		
		OR = {
			has_global_flag = bwm_conduit_pillar_1_activated
			has_global_flag = bwm_conduit_pillar_2_activated
			has_global_flag = bwm_conduit_pillar_3_activated
			has_global_flag = bwm_conduit_pillar_4_activated
		}
		NOT = {
			has_global_flag = bwm_conduit_eye_appeared 
		}
	}
	
	mean_time_to_happen = {
		years = 2000
		
		modifier = {
			factor = 0.75
			has_global_flag = bwm_conduit_pillar_1_activated
		}
		modifier = {
			factor = 0.50
			AND = {
				has_global_flag = bwm_conduit_pillar_1_activated
				has_global_flag = bwm_conduit_pillar_2_activated
			}
		}
		modifier = {
			factor = 0.25
			AND = {
				has_global_flag = bwm_conduit_pillar_1_activated
				has_global_flag = bwm_conduit_pillar_2_activated
				has_global_flag = bwm_conduit_pillar_3_activated
			}
		}
		modifier = {
			factor = 0.01
			AND = {
				has_global_flag = bwm_conduit_pillar_1_activated
				has_global_flag = bwm_conduit_pillar_2_activated
				has_global_flag = bwm_conduit_pillar_3_activated
				has_global_flag = bwm_conduit_pillar_4_activated
			}
		}
	}
	
	immediate = {
		random_system = {
			limit = { has_star_flag = bwm_garden_system }
			every_system_planet = {
				if = {
					limit = { 
						has_planet_flag = bwm_conduit_garden
					}
					add_modifier = {
						modifier = "bwm_obelisk_5_mod"
						days = -1
					}
				}
				if = {
					limit = {
						is_star = yes
					}
					save_event_target_as = bwm_garden_star_locator
				}
			}
			create_ambient_object = {
				type = "bwm_conduit_eye_object"
			}
			last_created_ambient_object = {
				set_location = event_target:bwm_garden_star_locator
				set_ambient_object_flag = bwm_conduit_eye_flag
				save_event_target_as = bwm_conduit_eye_locator
			}
			create_ambient_object = {
				type = bwm_effect_explosion_3_object
				duration = 10
				
				use_3d_location = yes
				
				entity_offset = { min = 0 max = 0 }
				entity_offset_angle = { min = 0 max = 0 }
				entity_offset_height = { min = 0 max = 0 }
				
				entity_scale_to_size = yes
				scale = 5
			}
			last_created_ambient_object = {
				set_location = event_target:bwm_conduit_eye_locator
			}
			save_event_target_as = bwm_conduit_system
		}
		every_country = {
			if = {
				limit = {
					is_ai = no
					any_owned_planet = {
						has_planet_flag = bwm_conduit_garden
					}
				}
				set_country_flag = bwm_conduit_target
				country_event = { id = bwm_the_conduit.51 }
			}
		}
		set_global_flag = bwm_conduit_eye_appeared
		country_event = { id = bwm_the_conduit.55 days = 1800 }
	}
}

country_event = {
	id = bwm_the_conduit.51
	title = "bwm_the_conduit.51"
	desc = "bwm_the_conduit.51.desc"
	picture = GFX_evt_unknown_ships
	show_sound = event_activating_unknown_technology
	
	is_triggered_only = yes

	option = {
		name = WORRYING
	}
}

#Conduit Crisis Start
country_event = {
	id = bwm_the_conduit.55
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		create_country = {
			name = "The Garden"
			type = bwm_conduit_guardian
			flag = {
				icon = {
					category = "spherical"
					file = "flag_spherical_20.dds"
				}
				background= {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				 colors={
						"dark_brown"
						"dark_brown"
						"null"
						"null"
				}
			}
		}
		last_created_country = {
		if = {
			limit = {
				NOT = {
					has_modifier = bwm_conduit_power
				}
			}
			add_modifier = {
				modifier = bwm_conduit_power
				days = -1
			}
		}
		save_event_target_as = bwm_Seekers
		save_global_event_target_as = bwm_conduit_country
		set_country_flag = bwm_conduit_country
		set_graphical_culture = fallen_empire_03
		guardian_difficulty = yes
		}
		event_target:bwm_conduit_system = {
			random_system_planet = {
				limit = {
					has_planet_flag = bwm_conduit_garden
				}
				set_owner = event_target:bwm_conduit_country
			}
			random_system_ambient_object = {
				limit = { has_ambient_object_flag = bwm_conduit_eye_flag }
				save_event_target_as = bwm_conduit_eye_spawn
			}
			bwm_conduit_owner_swap = yes
		}
		random_system = {
			limit = {
				distance = {
					source = event_target:bwm_conduit_system
					max_distance = 100
					min_distance = 0
				}
				NAND = {
					OR = {
						has_star_flag = enclave
						has_star_flag = guardian
						has_star_flag = ruined_dyson_system
						has_star_flag = ruined_sentry_system
						has_star_flag = bwm_conduit_anchor_1
						has_star_flag = bwm_conduit_anchor_2
						has_star_flag = bwm_conduit_anchor_3
						has_star_flag = bwm_ring_system
						has_star_flag = bwm_grave_system
						has_star_flag = bwm_garden_system
						has_star_flag = bwm_prison_system
						has_star_flag = bwm_gate_system
					}
					any_planet = {
						OR = {
							is_planet_class = pc_black_hole 
							is_planet_class = pc_neutron_star
							is_planet_class = pc_pulsar
							is_homeworld = yes
							is_capital = yes
						}
					}
				}
			}
			random_system_planet = {
				limit = {
					is_star = yes 
				}
				change_planet_size = -5
				save_event_target_as = bwm_conduit_anchor_1_spawn	
			}
			bwm_conduit_owner_swap = yes
			set_star_flag = bwm_conduit_anchor_1
		}
		random_system = {
			limit = {
				distance = {
					source = event_target:bwm_conduit_system
					max_distance = 100
					min_distance = 0
				}
				NAND = {
					OR = {
						has_star_flag = enclave
						has_star_flag = guardian
						has_star_flag = ruined_dyson_system
						has_star_flag = ruined_sentry_system
						has_star_flag = bwm_conduit_anchor_1
						has_star_flag = bwm_conduit_anchor_2
						has_star_flag = bwm_conduit_anchor_3
						has_star_flag = bwm_ring_system
						has_star_flag = bwm_grave_system
						has_star_flag = bwm_garden_system
						has_star_flag = bwm_prison_system
						has_star_flag = bwm_gate_system
					}
					any_planet = {
						OR = {
							is_planet_class = pc_black_hole 
							is_planet_class = pc_neutron_star
							is_planet_class = pc_pulsar
							is_homeworld = yes
							is_capital = yes
						}
					}
				}
			}
			random_system_planet = {
				limit = {
					is_star = yes 
				}
				change_planet_size = -5
				save_event_target_as = bwm_conduit_anchor_2_spawn	
			}
			bwm_conduit_owner_swap = yes
			set_star_flag = bwm_conduit_anchor_2
		}
		random_system = {
			limit = {
				distance = {
					source = event_target:bwm_conduit_system
					max_distance = 100
					min_distance = 0
				}
				NAND = {
					OR = {
						has_star_flag = enclave
						has_star_flag = guardian
						has_star_flag = ruined_dyson_system
						has_star_flag = ruined_sentry_system
						has_star_flag = bwm_conduit_anchor_1
						has_star_flag = bwm_conduit_anchor_2
						has_star_flag = bwm_conduit_anchor_3
						has_star_flag = bwm_ring_system
						has_star_flag = bwm_grave_system
						has_star_flag = bwm_garden_system
						has_star_flag = bwm_prison_system
						has_star_flag = bwm_gate_system
					}
					any_planet = {
						OR = {
							is_planet_class = pc_black_hole 
							is_planet_class = pc_neutron_star
							is_planet_class = pc_pulsar
							is_homeworld = yes
							is_capital = yes
						}
					}
				}
			}
			random_system_planet = {
				limit = {
					is_star = yes 
				}
				change_planet_size = -5
				save_event_target_as = bwm_conduit_anchor_3_spawn	
			}
			bwm_conduit_owner_swap = yes
			set_star_flag = bwm_conduit_anchor_3
		}
		random_system = {
			limit = {
				distance = {
					source = event_target:bwm_conduit_system
					max_distance = 100
					min_distance = 0
				}
				NAND = {
					OR = {
						has_star_flag = enclave
						has_star_flag = guardian
						has_star_flag = ruined_dyson_system
						has_star_flag = ruined_sentry_system
						has_star_flag = bwm_conduit_anchor_1
						has_star_flag = bwm_conduit_anchor_2
						has_star_flag = bwm_conduit_anchor_3
						has_star_flag = bwm_ring_system
						has_star_flag = bwm_grave_system
						has_star_flag = bwm_garden_system
						has_star_flag = bwm_prison_system
						has_star_flag = bwm_gate_system
					}
					any_planet = {
						OR = {
							is_planet_class = pc_black_hole 
							is_planet_class = pc_neutron_star
							is_planet_class = pc_pulsar
							is_homeworld = yes
							is_capital = yes
						}
					}
				}
			}
			random_system_planet = {
				limit = {
					is_star = yes 
				}
				change_planet_size = -5
				save_event_target_as = bwm_conduit_anchor_4_spawn	
			}
			bwm_conduit_owner_swap = yes
			set_star_flag = bwm_conduit_anchor_4
		}
		bwm_conduit_anchor_1 = yes
		last_created_fleet = {
			bwm_effect_explosion_4 = yes
		}
		bwm_conduit_anchor_2 = yes
		last_created_fleet = {
			bwm_effect_explosion_4 = yes
		}
		bwm_conduit_anchor_3 = yes
		last_created_fleet = {
			bwm_effect_explosion_4 = yes
		}
		bwm_conduit_anchor_4 = yes
		last_created_fleet = {
			bwm_effect_explosion_4 = yes
		}
		bwm_conduit_bulwark = yes
		last_created_fleet = {
			bwm_effect_explosion_4 = yes
		}
		while = {
			count = 3
			bwm_conduit_fleet_1 = yes
		}
		while = {
			count = 2
			bwm_conduit_fleet_2 = yes
		}	
		bwm_conduit_fleet_3 = yes	
		
		#Anchor 1
		
		while = {
			count = 2
			bwm_conduit_fleet_anchor_1_small = yes
		}
		bwm_conduit_fleet_anchor_1_big = yes
		
		#Anchor 2

		while = {
			count = 2
			bwm_conduit_fleet_anchor_2_small = yes
		}
		bwm_conduit_fleet_anchor_2_big = yes
		
		#Anchor 3

		while = {
			count = 2
			bwm_conduit_fleet_anchor_3_small = yes
		}
		bwm_conduit_fleet_anchor_3_big = yes
		
		#Anchor 4
		
		while = {
			count = 2
			bwm_conduit_fleet_anchor_4_small = yes
		}
		bwm_conduit_fleet_anchor_4_big = yes

		event_target:bwm_conduit_eye_spawn = {
			destroy_ambient_object = this 
		}
		every_country = {
			if = {
				limit = {
					is_ai = no
					NOT = {
						has_event_chain = bwm_lex_conduit_chain
					}
				}
				begin_event_chain = {
					event_chain = "bwm_lex_conduit_chain"
					target = this
				}
			}
			if = {
				limit = {
					is_ai = no
					has_country_flag = bwm_conduit_target
				}
				country_event = { id = bwm_the_conduit.56 }
			}
			create_point_of_interest = {
				id = bwm_conduit_anchor_poi.1
				name = "bwm_conduit_anchor_1_poi"
				desc = "bwm_conduit_anchor_1_poi_desc"
				event_chain = bwm_lex_conduit_chain
				location = event_target:bwm_conduit_anchor_1_spawn
			}
			create_point_of_interest = {
				id = bwm_conduit_anchor_poi.2
				name = "bwm_conduit_anchor_2_poi"
				desc = "bwm_conduit_anchor_2_poi_desc"
				event_chain = bwm_lex_conduit_chain
				location = event_target:bwm_conduit_anchor_2_spawn
			}
			create_point_of_interest = {
				id = bwm_conduit_anchor_poi.3
				name = "bwm_conduit_anchor_3_poi"
				desc = "bwm_conduit_anchor_3_poi_desc"
				event_chain = bwm_lex_conduit_chain
				location = event_target:bwm_conduit_anchor_3_spawn
			}
			create_point_of_interest = {
				id = bwm_conduit_anchor_poi.4
				name = "bwm_conduit_anchor_4_poi"
				desc = "bwm_conduit_anchor_4_poi_desc"
				event_chain = bwm_lex_conduit_chain
				location = event_target:bwm_conduit_anchor_4_spawn
			}
			establish_communications_no_message = event_target:bwm_conduit_country
		}
	}
}

country_event = {
	id = bwm_the_conduit.56
	title = "bwm_the_conduit.56"
	desc = "bwm_the_conduit.56.desc"
	picture = GFX_evt_fleet_evil
	show_sound = event_red_alert
	location = event_target:bwm_conduit_system
	
	is_triggered_only = yes
	
	option = {
		name = "bwm_the_conduit.56.a"
	}
}

fleet_event = {
	id = bwm_the_conduit.57
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		queue_actions = {
			repeat = {
				find_random_system = {
					trigger = {
						id = bwm_conduit_roam.4.trigger.1
						NOT = {
							OR = {
								has_star_flag = enclave
								has_star_flag = guardian
								has_star_flag = bwm_ring_system
								has_star_flag = bwm_grave_system
								has_star_flag = bwm_garden_system
								has_star_flag = bwm_prison_system
							}
						}
						is_inside_border = event_target:bwm_conduit_country 
					}
					found_system = {
						move_to = this
					}
				}
				find_closest_planet = {
					trigger = {
						id = bwm_conduit_roam.4.trigger.2
						is_star = yes
					}
					found_planet = {
						move_to = this
						orbit_planet = this
						wait = {
							duration = 10
							random = 50
						}
					}
				}
			}
		}
	}
}

#Conduit Crisis Final Fleet
fleet_event = {
	id = bwm_the_conduit.60
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		event_target:bwm_Seekers = {
			bwm_conduit_fleet_boss = yes
		}
	}
}

#Conduit Crisis Fleet 1
fleet_event = {
	id = bwm_the_conduit.61
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		event_target:bwm_Seekers = {
			bwm_conduit_fleet_roaming_1 = yes
		}
	}
}

#Conduit Crisis Fleet 2
fleet_event = {
	id = bwm_the_conduit.62
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		event_target:bwm_Seekers = {
			bwm_conduit_fleet_roaming_2 = yes
		}
	}
}

#Conduit Crisis Fleet 3
fleet_event = {
	id = bwm_the_conduit.63
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		event_target:bwm_Seekers = {
			bwm_conduit_fleet_roaming_3 = yes
		}
	}
}

#Conduit Mothership summons help

fleet_event = {
	id = bwm_the_conduit.64
	hide_window = yes
	
	trigger = {
		NAND = {
			has_global_flag = bwm_conduit_anchor_1_off
			has_global_flag = bwm_conduit_anchor_2_off
			has_global_flag = bwm_conduit_anchor_3_off
			has_global_flag = bwm_conduit_anchor_4_off
		}
		any_combatant_fleet = {
			exists = owner
			owner = {
				is_country_type = bwm_conduit_guardian
			}
			NOT = { 
				has_fleet_flag = bwm_conduit_summon_cooldown
			}
			any_owned_ship = {
				is_ship_size = bwm_conduit_fortress
				has_hp_percentage < 0.8
				has_hp_percentage > 0
			}
		}	
	}
	
	immediate = {
		random_combatant_fleet = {
			limit = {
				exists = owner
				owner = {
					is_country_type = bwm_conduit_guardian
				}
				NOT = { 
					has_fleet_flag = bwm_conduit_summon_cooldown
				}
				any_owned_ship = {
					is_ship_size = bwm_conduit_fortress
				}
			}
			random_system = {
				limit = {
					has_star_flag = bwm_garden_system
				}
				random_system_planet = {
					limit = {
						is_star = yes
					}
					bwm_effect_explosion_4 = yes
					save_event_target_as = bwm_conduit_summon
				}
				every_fleet_in_system = {
					if = {
						limit = {
							exists = owner
							owner = {
								is_ai = no
								NOT = {
									is_country_type = bwm_conduit_guardian
								}
							}
						}
						owner = {
							country_event = { id = bwm_the_conduit.65 }
						}
					}
				}
			}
			event_target:bwm_conduit_country = {
				every_owned_fleet = {
						limit = {
							has_fleet_flag = bwm_conduit_fleet
						}
						set_location = event_target:bwm_conduit_summon
				}
				random_list = {
					33 = {
						bwm_conduit_summon_1 = yes
					}
					33 = {
						bwm_conduit_summon_2 = yes
					}
					33 = {
						bwm_conduit_summon_3 = yes
					}
					1 = {
						bwm_conduit_summon_4 = yes
					}
				}
			}
			set_timed_fleet_flag = {
				flag = bwm_conduit_summon_cooldown
				days = 3600
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.65
	title = "bwm_the_conduit.65"
	desc = "bwm_the_conduit.65.desc"
	picture = GFX_evt_unknown_ships
	show_sound = event_yellow_alert
	location = event_target:bwm_conduit_summon
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = bwm_conduit_summon_notification
		}
	}
	
	immediate = {
		set_timed_country_flag = {
			flag = bwm_conduit_summon_notification
			days = 30
		}
	}
	
	option = {
		name = BATTLESTATIONS
	}
}

#Conduit Crisis Research (Hidden)
country_event = {
	id = bwm_the_conduit.70
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_country_type = bwm_conduit_guardian
		
		from = {
			NOT = {
				has_country_flag = bwm_conduit_weakness_check
			}
			is_ai = no
			
			AND = {
				OR = {
					has_technology = "tech_ship_armor_5"
					has_technology = "tech_dragon_armor"
					has_technology = "tech_bwm_lex_armor"
				}
				OR = {
					has_technology = "tech_shields_5"
					has_technology = "tech_psionic_shield"
					has_technology = "tech_enigmatic_deflector"
					has_technology = "tech_bwm_lex_shield"
				}		
				OR = {
					has_technology = "tech_zero_point_power"
					has_technology = "tech_enigmatic_power_core"
					has_technology = "tech_bwm_lex_power"
				}
				OR = {
					has_technology = "tech_energy_lance_2"
					has_technology = "tech_arc_emitter_2"
					has_technology = "tech_mass_accelerator_2"
				}
			}
		}
	}

	immediate = {
		random_list = {
			50 = {
				if = {
					limit = {
						check_variable = {
							which = "bwm_conduit_kill_counter"
							value < 1
						}
					}
					set_variable = {
						which = "bwm_conduit_kill_counter"
						value = 1
					}
					else = {
						change_variable = {
							which = "bwm_conduit_kill_counter"
							value = 1
						}
						if = {
							limit ={
								check_variable = {
									which = "bwm_conduit_kill_counter"
									value > 5
								}
							}
							set_variable = {
								which = "bwm_conduit_kill_counter"
								value = 5
							}
						}
						if = {
							limit = {
								check_variable = {
									which = "bwm_conduit_kill_counter"
									value = 5
								}
							}
							from = {
								set_country_flag = bwm_conduit_weakness_check
								country_event = { id = bwm_the_conduit.71 days = 30 }
							}
						}
					}
				}
			}
			50 = {
			}
		}
	}
}

#Conduit Crisis Research (Offer Project)
country_event = {
	id = bwm_the_conduit.71
	title = "bwm_the_conduit.71"
	desc = "bwm_the_conduit.71.desc"
	picture = GFX_evt_exploding_ship
	is_triggered_only = yes

	trigger = {
		NOT = {
			any_country = {
				has_country_flag = bwm_conduit_slayer
			}
			has_country_flag = bwm_conduit_weakness_researched 
		}
	}

	option = {
		name = bwm_the_conduit.71.a
		allow = {
			hidden_trigger = {
				NOT = { has_modifier = bwm_conduit_weakness }
			}
		}
		capital_scope = { save_event_target_as = bwm_pc_home }
		hidden_effect = { set_country_flag = bwm_conduit_weakness_researched }
		enable_special_project = {
			name = "bwm_CONDUIT_WEAKNESS_PROJECT"
			location = event_target:bwm_pc_home
			owner = ROOT
		}
	}
	option = {
		name = bwm_the_conduit.71.b
		add_influence = 100
	}
}

#Conduit Crisis Research (Project Complete)
country_event = {
	id = bwm_the_conduit.72
	title = "bwm_the_conduit.72"
	desc = "bwm_the_conduit.72.desc"
	picture = GFX_evt_physics_research
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_modifier = bwm_conduit_weakness
		}
	}
	
	option = {
		name = bwm_the_conduit.72.a
		add_modifier = {
			modifier = bwm_conduit_weakness
			days = -1
		}
	}
}

#Avatar Destroyed
country_event = {
	id = bwm_the_conduit.80
	hide_window = yes
	is_triggered_only = yes
	
	fire_only_once = yes

	trigger = {
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_avatar
		}
	}

	immediate = {
		FROMFROM = {
			bwm_effect_explosion_4 = yes
		}
		every_country = {
			limit = { 
				is_country_type = bwm_conduit_guardian
				NOT = { has_modifier = bwm_conduit_avatar_debuff }
			}
			add_modifier = {
				modifier = "bwm_conduit_avatar_debuff"
				days = -1
			}
		}
	}
}

#Anchor 1 Destroyed
country_event = {
	id = bwm_the_conduit.81
	hide_window = yes
	is_triggered_only = yes
	
	fire_only_once = yes

	trigger = {
		NOT = {
			has_global_flag = bwm_conduit_anchor_1_off
		}
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_anchor
			solar_system = {
				has_star_flag = bwm_conduit_anchor_1
			}
		}
	}

	immediate = {
		FROMFROM = {
			bwm_effect_explosion_4 = yes
			solar_system = {
				random_planet = {
					limit = {
						is_star = yes
					}
					change_planet_size = 5
				}
			}
		}
		every_country = {
			if = {
				limit = {
					has_event_chain = "bwm_lex_conduit_chain" 
				}
				remove_point_of_interest = bwm_conduit_anchor_poi.1
				add_event_chain_counter = { 
					event_chain = "bwm_lex_conduit_chain" 
					counter = "bwm_conduit_anchor_counter" 
					amount = 1 
				}
			}
			if = {
				limit = { 
					is_country_type = bwm_conduit_guardian
					NOT = {
						has_modifier = bwm_conduit_anchor_1_debuff 
					}
				}
				add_modifier = {
					modifier = "bwm_conduit_anchor_1_debuff"
					days = -1
				}
			}
		}
		set_global_flag = bwm_conduit_anchor_1_off
	}
}

#Anchor 2 Destroyed
country_event = {
	id = bwm_the_conduit.82
	hide_window = yes
	is_triggered_only = yes
	
	fire_only_once = yes

	trigger = {
		NOT = {
			has_global_flag = bwm_conduit_anchor_2_off
		}
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_anchor
			solar_system = {
				has_star_flag = bwm_conduit_anchor_2
			}
		}
	}

	immediate = {
		FROMFROM = {
			bwm_effect_explosion_4 = yes
			solar_system = {
				random_planet = {
					limit = {
						is_star = yes
					}
					change_planet_size = 5
				}
			}
		}
		every_country = {
			if = {
				limit = {
					has_event_chain = "bwm_lex_conduit_chain" 
				}
				remove_point_of_interest = bwm_conduit_anchor_poi.2
				add_event_chain_counter = { 
					event_chain = "bwm_lex_conduit_chain" 
					counter = "bwm_conduit_anchor_counter" 
					amount = 1 
				}
			}
			if = {
				limit = { 
					is_country_type = bwm_conduit_guardian
					NOT = {
						has_modifier = bwm_conduit_anchor_2_debuff 
					}
				}
				add_modifier = {
					modifier = "bwm_conduit_anchor_2_debuff"
					days = -1
				}
			}
		}
		set_global_flag = bwm_conduit_anchor_2_off
	}
}

#Anchor 3 Destroyed
country_event = {
	id = bwm_the_conduit.83
	hide_window = yes
	is_triggered_only = yes
	
	fire_only_once = yes

	trigger = {
		NOT = {
			has_global_flag = bwm_conduit_anchor_3_off
		}
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_anchor
			solar_system = {
				has_star_flag = bwm_conduit_anchor_3
			}
		}
	}

	immediate = {
		FROMFROM = {
			bwm_effect_explosion_4 = yes
			solar_system = {
				random_planet = {
					limit = {
						is_star = yes
					}
					change_planet_size = 5
				}
			}
		}
		every_country = {
			if = {
				limit = {
					has_event_chain = "bwm_lex_conduit_chain" 
				}
				remove_point_of_interest = bwm_conduit_anchor_poi.3
				add_event_chain_counter = { 
					event_chain = "bwm_lex_conduit_chain" 
					counter = "bwm_conduit_anchor_counter" 
					amount = 1 
				}
			}
			if = {
				limit = { 
					is_country_type = bwm_conduit_guardian
					NOT = {
						has_modifier = bwm_conduit_anchor_3_debuff 
					}
				}
				add_modifier = {
					modifier = "bwm_conduit_anchor_3_debuff"
					days = -1
				}
			}
		}
		set_global_flag = bwm_conduit_anchor_3_off
	}
}

#Anchor 4 Destroyed
country_event = {
	id = bwm_the_conduit.84
	hide_window = yes
	is_triggered_only = yes
	
	fire_only_once = yes

	trigger = {
		NOT = {
			has_global_flag = bwm_conduit_anchor_4_off
		}
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_anchor
			solar_system = {
				has_star_flag = bwm_conduit_anchor_4
			}
		}
	}

	immediate = {
		FROMFROM = {
			bwm_effect_explosion_4 = yes
			solar_system = {
				random_planet = {
					limit = {
						is_star = yes
					}
					change_planet_size = 5
				}
			}
		}
		every_country = {
			if = {
				limit = {
					has_event_chain = "bwm_lex_conduit_chain" 
				}
				remove_point_of_interest = bwm_conduit_anchor_poi.4
				add_event_chain_counter = { 
					event_chain = "bwm_lex_conduit_chain" 
					counter = "bwm_conduit_anchor_counter" 
					amount = 1 
				}
			}
			if = {
				limit = { 
					is_country_type = bwm_conduit_guardian
					NOT = {
						has_modifier = bwm_conduit_anchor_4_debuff 
					}
				}
				add_modifier = {
					modifier = "bwm_conduit_anchor_4_debuff"
					days = -1
				}
			}
		}
		set_global_flag = bwm_conduit_anchor_4_off
	}
}

#Conduit Crisis Clear (Hidden)
country_event = {
	id = bwm_the_conduit.100
	hide_window = yes
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		is_country_type = bwm_conduit_guardian
		has_country_flag = bwm_conduit_country
		FROMFROM = {
			is_ship_size = bwm_conduit_fortress 
		}
	}
	
	immediate = {
		FROMFROM = {
			bwm_effect_explosion_4 = yes
		}
		FROM = {
			save_event_target_as = bwm_conduit_slayer_target
			set_country_flag = bwm_conduit_slayer
			add_threat = {
				who = THIS
				amount = 10
			}
		}
		random_system = {
			limit = {
				has_star_flag = bwm_garden_system 
			}
			random_system_planet = {
				limit = {
					has_planet_flag = bwm_conduit_garden
				}
				if = {
					limit = {
						has_modifier = bwm_obelisk_5_mod
					}
					remove_modifier = bwm_obelisk_5_mod
				}
				if = {
					limit = {
						NOT = {
							has_modifier = bwm_obelisk_6_mod
						}
					}
					add_modifier = {
						modifier = "bwm_obelisk_6_mod"
						days = 3600
					}
				}
				every_owned_pop = {
					if = {
						limit = {
							NOT = {
								has_modifier = bwm_pop_conduit_5
							}
						}
						add_modifier = {
							modifier = "bwm_pop_conduit_5"
							days = 3600
						}
					}
				}
				set_owner = event_target:bwm_conduit_slayer_target
				save_event_target_as = bwm_garden_aid
			}
			save_event_target_as = bwm_conduit_system 
		}
		every_country = {
			if = {
				limit = {
					has_event_chain = "bwm_lex_conduit_chain" 
				}
				end_event_chain = "bwm_lex_conduit_chain"
			}
			if = {
				limit = { 
					has_modifier = bwm_conduit_weakness
				}
				remove_modifier = "bwm_conduit_weakness"
			}
			if = {
				limit = {
					has_special_project = bwm_CONDUIT_WEAKNESS_PROJECT
				}
				abort_special_project = {
					type = "bwm_CONDUIT_WEAKNESS_PROJECT"
					location = capital_scope
				}
			}
			if = {
				limit = {
					has_country_flag = bwm_conduit_slayer
					any_system = {
						AND = {
							has_star_flag = bwm_garden_system
							any_planet = {
								has_planet_flag = bwm_conduit_garden
							}
						}
					}
				}
				if = {
					limit = {
						is_ai = no
					}
					country_event = { id = bwm_the_conduit.101 }
					else = {
						if = {
							limit = {
								is_ai = yes
								OR = {
									is_country_type = default
									is_country_type = fallen_empire
									is_country_type = awakened_fallen_empire
								}
							}
							set_country_flag = bwm_the_conduit_ai_path
							country_event = { id = bwm_the_conduit.102  }
						}
					}
				}
			}
		}
		every_owned_ship = {
			if = {
				limit = {
					exists = THIS
					is_ship_size = bwm_conduit_anchor
				}
				fleet = {
					destroy_fleet = THIS
				}
			}
		}
		every_owned_fleet = {
			limit = {
				exists = THIS
			}
			clear_orders = yes 
			queue_actions = {
				repeat = {
					find_random_system = {
						trigger = {
							id = bwm_conduit_scatter.1
							NOT = {
								OR = {
									has_star_flag = guardian
									has_star_flag = bwm_ring_system
									has_star_flag = bwm_grave_system
									has_star_flag = bwm_garden_system
									has_star_flag = bwm_prison_system
									has_star_flag = bwm_gate_system
								}
							}
						}
						found_system = {
							move_to = this
							
							find_closest_planet = {
								trigger = {
									id =  bwm_conduit_scatter.2
									is_star = yes
								}
								found_planet = {
									move_to = this
									wait = {
										duration = 360
										random = 180
									}
								}
							}
						}
					}
				}
			}
		}
		bwm_awaken = yes
	}
}

#Conduit Crisis Clear
country_event = {
	id = bwm_the_conduit.101
	title = "bwm_the_conduit.101"
	desc = "bwm_the_conduit.101.desc"
	picture = GFX_evt_small_space_battle
	show_sound = event_space_battle
	location = event_target:bwm_conduit_system 
	
	is_triggered_only = yes
	
	trigger = {
		is_ai = no
		NOT = {
			has_country_flag = bwm_conduit_aid_notify
		}
	}

	immediate = {
		set_country_flag = bwm_conduit_aid_notify
	}
	
	option = {
		name = "bwm_the_conduit.101.a"
		event_target:bwm_garden_aid = {
			enable_special_project = {
				name = "bwm_GARDEN_HELP"
				location = THIS
				owner = ROOT
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.102
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		has_country_flag = bwm_the_conduit_ai_path
		NOT = {
			has_country_flag = bwm_garden_aid_complete 
		}
	}

	immediate = {
		set_country_flag = bwm_garden_aid_complete
		every_owned_pop = {
			if = {
					limit = { has_modifier = bwm_pop_conduit_1 }
					remove_modifier = bwm_pop_conduit_1
			}	
			if = {
					limit = { has_modifier = bwm_pop_conduit_2 }
					remove_modifier = bwm_pop_conduit_2
			}
			if = {
					limit = { has_modifier = bwm_pop_conduit_3 }
					remove_modifier = bwm_pop_conduit_3
			}
			if = {
					limit = { has_modifier = bwm_pop_conduit_4 }
					remove_modifier = bwm_pop_conduit_4
			}
			if = {
					limit = { has_modifier = bwm_pop_conduit_5 }
					remove_modifier = bwm_pop_conduit_5
			}
		}
		country_event = { id = bwm_the_conduit.103 days = 1800 }
	}
}

country_event = {
	id = bwm_the_conduit.103
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		NOT = {
			has_country_flag = bwm_the_conduit_ai_lock_1
		}
		has_country_flag = bwm_the_conduit_ai_path
		has_country_flag = bwm_garden_aid_complete
	}

	immediate = {
		set_country_flag = bwm_the_conduit_ai_lock_1
		this = {
			save_event_target_as = bwm_conduit_project_ai_owner
		}
		random_system = {
			limit = {
				has_star_flag = bwm_garden_system
			}
			random_system_planet = {
				limit = {
					is_planet_class = pc_molten
				}
				save_event_target_as = bwm_garden_molten
			}
		}
		create_fleet = {
			name = "Bound Avatar"
			settings = {
				spawn_debris = no 
			}
			effect = {
				set_owner = event_target:bwm_conduit_project_ai_owner
				create_ship = {
					name = "Conduit"
					design = "Seqtet"
					graphical_culture = "fallen_empire_03"
					prefix = no
				}
				set_location = event_target:bwm_garden_molten
			}
		}
		every_country = {
			limit = {
				has_communications = event_target:bwm_conduit_project_ai_owner 
				NOT = {
					is_country = event_target:bwm_conduit_project_ai_owner 
				}
				OR = {
					is_country_type = default
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire		
				}	
			}
			add_opinion_modifier = { who = event_target:bwm_conduit_project_ai_owner modifier = bwm_conduit_leviathan_owner }
		}
		every_country = {
			limit = {
				is_ai = no
			}
			country_event = { id = bwm_the_conduit.107 days = 30 }
		}
		country_event = { id = bwm_the_conduit.104 days = 3600 }
	}
}

country_event = {
	id = bwm_the_conduit.104
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		has_country_flag = bwm_the_conduit_ai_path
		NOT = {
			has_country_flag = bwm_the_conduit_ai_lock_2
		}
		any_owned_ship = {
			is_ship_size = bwm_conduit_avatar_bound
		}
	}
	
	immediate = {
		set_country_flag = bwm_the_conduit_ai_lock_2
		this = {
			save_event_target_as = bwm_conduit_avatar_ai_owner
		}
		random_owned_ship = {
			limit = {
				is_ship_size = bwm_conduit_avatar_bound
			}
			save_event_target_as = bwm_conduit_avatar_ai_spawn
			create_fleet = {
			name = "Unbound Avatar"
			settings = {
				spawn_debris = no 
			}
			effect = {
				set_owner = event_target:bwm_conduit_avatar_ai_owner
				create_ship = {
					name = "Conduit"
					design = "Matet"
					graphical_culture = "fallen_empire_03"
					prefix = no
				}
				set_location = {
					target = event_target:bwm_conduit_avatar_ai_spawn
					distance = 0
					angle = random
					}	
				}
			}
			last_created_fleet = {
				bwm_effect_explosion_4 = yes
			}
			fleet = {
				delete_fleet = this
			}
		}
		country_event = { id = bwm_the_conduit.105 days = 3600 }
	}
}

country_event = {
	id = bwm_the_conduit.105
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		has_country_flag = bwm_the_conduit_ai_path
		NOT = {
			has_country_flag = bwm_conduit_overdrive_unlock
		}
		any_owned_ship = {
			is_ship_size = bwm_conduit_avatar
		}
	}
	
	immediate = {
		set_country_flag = bwm_conduit_overdrive_unlock 
		country_event = { id = bwm_the_conduit.106 days = 3600 }
	}
}

country_event = {
	id = bwm_the_conduit.106
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		NOT = {
			has_technology = "tech_bwm_magma_diver"
			has_country_flag = bwm_ai_tech_toggle_3
		}
		has_country_flag = bwm_the_conduit_ai_path
		has_country_flag = bwm_conduit_overdrive_unlock
		any_owned_ship = {
			is_ship_size = bwm_conduit_avatar
		}
	}
	
	immediate = {
		set_country_flag = bwm_ai_tech_toggle_3
		add_research_option = tech_bwm_magma_diver
		add_tech_progress = {
			tech = tech_bwm_magma_diver
			progress = 0.1
		}
	}
}

country_event = {
	id = bwm_the_conduit.107
	title = "bwm_the_conduit.107"
	desc = "bwm_the_conduit.107.desc"
	picture = GFX_evt_small_space_battle
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = bwm_conduit_ai_capture_notify
		}
	}
	
	immediate = {
		set_country_flag = bwm_conduit_ai_capture_notify
	}
	
	option = {
		name = "CURSES"
	}
}

#Garden Aid Completion
ship_event = {
	id = bwm_the_conduit.110
	title = "bwm_the_conduit.110"
	desc = "bwm_the_conduit.110.desc"
	picture = GFX_evt_colony_settlement
	location = event_target:bwm_conduit_system

	is_triggered_only = yes

	trigger = {
		owner = {
			is_ai = no
			NOT = {
				has_country_flag = bwm_garden_aid_complete 
			}
		}
	}

	immediate = {
			owner = {
				set_country_flag = bwm_garden_aid_complete
				every_owned_pop = {
					if = {
							limit = { has_modifier = bwm_pop_conduit_1 }
							remove_modifier = bwm_pop_conduit_1
					}	
					if = {
							limit = { has_modifier = bwm_pop_conduit_2 }
							remove_modifier = bwm_pop_conduit_2
					}
					if = {
							limit = { has_modifier = bwm_pop_conduit_3 }
							remove_modifier = bwm_pop_conduit_3
					}
					if = {
							limit = { has_modifier = bwm_pop_conduit_4 }
							remove_modifier = bwm_pop_conduit_4
					}
					if = {
							limit = { has_modifier = bwm_pop_conduit_5 }
							remove_modifier = bwm_pop_conduit_5
					}
				}
			}
			random_system = {
				limit =  {
					has_star_flag = bwm_garden_system 
				}
				random_system_planet = {
					limit = {
						has_planet_flag = bwm_conduit_garden 
					}
					save_event_target_as = bwm_garden_clear
				}
			}
	}
	option = {
		name = bwm_the_conduit.110.a
	}
}

#Conduit Crisis Timed Reward Init (Make bwm_LAVA_DRIVER project available)
country_event = {
	id = bwm_the_conduit.121
	title = "bwm_the_conduit.121"
	desc = "bwm_the_conduit.121.desc"
	picture = GFX_evt_molten
	location = event_target:bwm_conduit_system
	
	fire_only_once = yes
	
	trigger = {
		is_ai = no
		any_country = {
			has_country_flag = bwm_garden_aid_complete
			has_country_flag = bwm_conduit_slayer
		}
		any_owned_planet = {
			has_planet_flag = bwm_conduit_garden
		}
	}
	
	mean_time_to_happen = {
		years = 5
	}
	
	immediate = {
		random_system = {
			limit = {
				has_star_flag = bwm_garden_system
			}
			save_event_target_as = bwm_conduit_system	
			random_system_planet = {
				limit = {
					is_planet_class = pc_molten
				}
				save_event_target_as = bwm_garden_molten
			}
		}
	}
	
	option = {
		name = "bwm_the_conduit.121.a"
		event_target:bwm_garden_molten = {
			enable_special_project = {
				name = "bwm_LAVA_DIVER"
				location = THIS
				owner = ROOT
			}
		}
	}
	
	option = {
		name = "bwm_the_conduit.121.b"
		add_influence = 100
	}
}

#Conduit Crisis Timed Reward (bwm_LAVA_DRIVER complete)
ship_event = {
	id = bwm_the_conduit.122
	title = "bwm_the_conduit.122"
	desc = "bwm_the_conduit.122.desc"
	picture = GFX_evt_ship_in_orbit
	show_sound = event_mystic_reveal_light
	location = event_target:bwm_conduit_system
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			owner = {
				has_country_flag = bwm_conduit_leviathan_unlock
			}
		}
	}
	
	immediate = {
		owner = {
			save_event_target_as = bwm_conduit_project_owner 
			set_country_flag = bwm_conduit_leviathan_unlock
		}
		
	}
	
	option = { 
		name = "bwm_the_conduit.122.a"
		hidden_effect = {
			random_system = {
				limit = {
					has_star_flag = bwm_garden_system
				}
				random_system_planet = {
					limit = {
						has_planet_flag = bwm_conduit_garden
					}
					save_event_target_as = bwm_conduit_fleet_reward_loc
				}
			}
			owner = {
				set_country_flag = bwm_the_conduit_reward_unlock
				country_event = { id = bwm_the_conduit.150 days = 1800 }
				add_threat = {
					who = THIS
					amount = 5
				}
			}
		}
		every_country = {
			limit = {
				has_communications = event_target:bwm_conduit_project_owner 
				NOT = {
					is_country = event_target:bwm_conduit_project_owner 
				}
				OR = {
					is_country_type = default
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire		
				}	
			}
			add_opinion_modifier = { who = event_target:bwm_conduit_project_owner modifier = bwm_conduit_leviathan_owner }
		}
		create_fleet = {
			name = "Bound Avatar"
			settings = {
				spawn_debris = no 
			}
			effect = {
				set_owner = event_target:bwm_conduit_project_owner
				create_ship = {
					name = "Conduit"
					design = "Seqtet"
					graphical_culture = "fallen_empire_03"
					prefix = no
				}
				set_location = root
			}
		}
	}
	
	option = {
		name = "bwm_the_conduit.122.b"
		owner = {
		add_minerals = 5000
		add_energy = 5000
			hidden_effect = {
				set_country_flag = bwm_the_conduit_reward_unlock
				country_event = { id = bwm_the_conduit.150 days = 1800 }
			}
		}
	}
}

#Conduit Crisis Timed Reward Upgrade Init (Make bwm_CONDUIT_AWAKENING project available)
country_event = {
	id = bwm_the_conduit.130
	title = "bwm_the_conduit.130"
	desc = "bwm_the_conduit.130.desc"
	picture = GFX_evt_unspeakable_horror

	trigger = {
		is_ai = no
		NOT = {
			has_country_flag = bwm_conduit_upgrade_lock
		}
		any_owned_ship = {
			is_ship_size = bwm_conduit_avatar_bound
		}
	}
	
	mean_time_to_happen = {
		years = 10

		modifier = {
			factor = 0.5
			any_owned_ship = {
				OR = {
					is_ship_size = bwm_titan
					is_ship_size = bwm_grave_awakened_pc
				}
			}
		}
	}
	
	immediate = {
		set_country_flag = bwm_conduit_upgrade_lock
		capital_scope = { save_event_target_as = bwm_pc_home }
	}

	option = {
		name = "bwm_the_conduit.130.a"
		event_target:bwm_pc_home = {
			enable_special_project = {
				name = "bwm_CONDUIT_AWAKENING"
				location = THIS
				owner = ROOT
			}
		}
	}
	option = {
		name = "bwm_the_conduit.130.b"
		add_influence = 100
	}
}

#Conduit Crisis Timed Reward Upgrade Activation (bwm_CONDUIT_AWAKENING project complete)
country_event = {
	id = bwm_the_conduit.131
	title = "bwm_the_conduit.131"
	desc = "bwm_the_conduit.131.desc"
	picture = GFX_evt_ship_in_orbit
	
	is_triggered_only = yes
	
	trigger = {
			is_ai = no
			NOT = {
				has_country_flag = bwm_conduit_avatar_awakening 
			}
			any_owned_ship = {
			is_ship_size = bwm_conduit_avatar_bound
			}
		}

	option = {
		name = "bwm_the_conduit.131.a"
		custom_tooltip = bwm_the_conduit.131.a.tooltip
		hidden_effect = {
			set_country_flag = bwm_conduit_avatar_awakening
		}
	}	
}

#Conduit Crisis Timed Reward Upgrade Transform
country_event = {
	id = bwm_the_conduit.132

	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		is_ai = no
		NOT = {
			has_country_flag = bwm_conduit_evolve_success 
		}
		has_country_flag = bwm_conduit_avatar_awakening
		any_owned_ship = {
			is_ship_size = bwm_conduit_avatar_bound
		}
	}
	
	immediate = {
		add_threat = {
			who = THIS
			amount = 5
		}
		FROMFROM = {
			OWNER = {
				save_event_target_as = bwm_conduit_avatar_owner
			}
			save_event_target_as = bwm_conduit_avatar_spawn
		}
		if = {
			limit = {
				FROMFROM = {
					OWNER = {
						count_owned_ships = {
							limit = {
								is_ship_size = bwm_conduit_avatar_bound
								FLEET = { is_same_value = event_target:bwm_conduit_avatar_spawn }
							}
							count > 0
						}
					}
				}
			}
			create_fleet = {
			name = "Unbound Avatar"
			settings = {
				spawn_debris = no 
			}
			effect = {
				set_owner = event_target:bwm_conduit_avatar_owner
				create_ship = {
					name = "Conduit"
					design = "Matet"
					graphical_culture = "fallen_empire_03"
					prefix = no
				}
				set_location = {
					target = event_target:bwm_conduit_avatar_spawn
					distance = 0
					angle = random
					}	
				}
			}
			FROMFROM = {
				delete_fleet = this
			}
			last_created_fleet = {
				bwm_effect_explosion_4 = yes
			}
			set_country_flag = bwm_conduit_evolve_success
		}
	}
}

country_event = {
	id = bwm_the_conduit.133
	title = "bwm_the_conduit.133"
	desc = "bwm_the_conduit.133.desc"
	picture = GFX_evt_galactic_senate

	trigger = {
		NOT = {
			has_country_flag = bwm_conduit_schematic_research
		}
		is_ai = no
		has_country_flag = bwm_conduit_evolve_success
		any_owned_ship = {
			is_ship_size = bwm_conduit_avatar
		}
	}
	
	mean_time_to_happen = {
		years = 10
		
		modifier = {
			factor = 0.5
				OR = {
					has_technology = "tech_bwm_solar_envoy"
					has_technology = "tech_bwm_gravekeeper"
				}
		}
	}
	
	immediate = {
		set_country_flag = bwm_conduit_schematic_research
		capital_scope = {
			save_event_target_as = bwm_pc_home
		}
	}

	option = {
		name = "bwm_the_conduit.133.a"
		custom_tooltip = bwm_the_conduit.133.a.tooltip
		hidden_effect = {
			every_owned_ship = {
				if = {
					limit = {
						exists = this
						is_ship_size = bwm_conduit_avatar
						NOT = {
							has_modifier = bwm_leviathan_research_debuff
						}
					}
					add_modifier = {
						modifier = "bwm_leviathan_research_debuff"
						days = -1
					}
				}
			}
		}
		event_target:bwm_pc_home = {
			enable_special_project = {
				name = "bwm_CONDUIT_SCHEMATICS_PROJECT"
				location = THIS
				owner = ROOT
			}
		}
	}
	option = {
		name = "bwm_the_conduit.133.b"
		add_influence = 100
		hidden_effect = {
			set_country_flag = bwm_conduit_schematic_tech_lock
		}
	}
}

country_event = {
	id = bwm_the_conduit.134
	title = "bwm_the_conduit.134"
	desc = "bwm_the_conduit.134.desc"
	picture = GFX_evt_sentient_AI
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_country_flag = bwm_conduit_schematic_tech_lock
		}
		is_ai = no
		has_country_flag = bwm_conduit_schematic_research
		any_owned_ship = {
			is_ship_size = bwm_conduit_avatar
		}
	}
	
	immediate = {
		set_country_flag = bwm_conduit_schematic_tech_lock
	}

	option = {
		name = MARVELOUS
		hidden_effect = {
			every_owned_ship = {
				if = {
					limit = {
						exists = this
						is_ship_size = bwm_conduit_avatar
						has_modifier = bwm_leviathan_research_debuff
					}
					remove_modifier = "bwm_leviathan_research_debuff"
				}
			}
		}
		if = {
			limit = {
				NOT = {
					has_technology = "tech_bwm_magma_diver"
				}
			}
			add_research_option = tech_bwm_magma_diver
			add_tech_progress = {
				tech = tech_bwm_magma_diver
				progress = 0.1
			}
		}
	}
}

#Broken Pillars
country_event = {
	id = bwm_the_conduit.140
	title = "bwm_the_conduit.140"
	desc = "bwm_the_conduit.140.desc"
	picture = GFX_evt_alien_ruins
	location = event_target:bwm_conduit_system
	
	fire_only_once = yes
	
	trigger = {
		is_ai = no
		AND = {
			has_country_flag = bwm_conduit_slayer
			has_country_flag = bwm_garden_aid_complete
		}
		any_owned_planet = {
			has_planet_flag = bwm_conduit_garden
			NOR = {
				has_building = "bwm_building_obelisk_0_1"
				has_building = "bwm_building_obelisk_0_2"
				has_building = "bwm_building_obelisk_0_3"
				has_building = "bwm_building_obelisk_0_4"
				has_building = "bwm_building_obelisk_1"
				has_building = "bwm_building_obelisk_2"
				has_building = "bwm_building_obelisk_3"
				has_building = "bwm_building_obelisk_4"
			}
		}
	}

	immediate = {
		random_system = {
			limit = {
				has_star_flag = bwm_garden_system 
			}
			every_system_ambient_object = {
				if = { 
					limit = {
						OR = {
							has_ambient_object_flag = bwm_conduit_pillar_1
							has_ambient_object_flag = bwm_conduit_pillar_2
							has_ambient_object_flag = bwm_conduit_pillar_3
							has_ambient_object_flag = bwm_conduit_pillar_4
							has_ambient_object_flag = bwm_conduit_pillar_1_on
							has_ambient_object_flag = bwm_conduit_pillar_2_on
							has_ambient_object_flag = bwm_conduit_pillar_3_on
							has_ambient_object_flag = bwm_conduit_pillar_4_on
						}
					}
					random_system = {
						limit = {
							has_star_flag = bwm_garden_system 
						}
						every_system_ambient_object = {
							limit = {
								OR = {
									has_ambient_object_flag = bwm_conduit_pillar_1
									has_ambient_object_flag = bwm_conduit_pillar_2
									has_ambient_object_flag = bwm_conduit_pillar_3
									has_ambient_object_flag = bwm_conduit_pillar_4
									has_ambient_object_flag = bwm_conduit_pillar_1_on
									has_ambient_object_flag = bwm_conduit_pillar_2_on
									has_ambient_object_flag = bwm_conduit_pillar_3_on
									has_ambient_object_flag = bwm_conduit_pillar_4_on
								}
							}
							destroy_ambient_object = this
						}
					}
				}
			}
			random_system_planet = {
				limit = {
					is_star = yes
				}
				bwm_effect_explosion_4 = yes
			}
			random_system_planet = {
				limit = {
					has_planet_flag = bwm_conduit_garden 
				}
				if = {
					limit = { has_modifier = bwm_obelisk_1_mod }
					remove_modifier = bwm_obelisk_1_mod
				}
				if = {
					limit = { has_modifier = bwm_obelisk_2_mod }
					remove_modifier = bwm_obelisk_2_mod
				}
				if = {
					limit = { has_modifier = bwm_obelisk_3_mod }
					remove_modifier = bwm_obelisk_3_mod
				}
				if = {
					limit = { has_modifier = bwm_obelisk_4_mod }
					remove_modifier = bwm_obelisk_4_mod
				}
				if = {
					limit = { has_modifier = bwm_obelisk_6_mod }
					remove_modifier = bwm_obelisk_6_mod
				}
				if = {
					limit = { 
						NOT = {
							has_modifier = bwm_obelisk_7_mod 
						}
					}
					add_modifier = {
						modifier = "bwm_obelisk_7_mod"
						days = -1
					}
				}
			}
		}
		set_country_flag = bwm_conduit_obelisks_destroyed
	}
	
	option = {
		name = bwm_the_conduit.140.a
	}
}

#Start fleet repairs ( Spawns on repeat every 5 years)
country_event = {
	id = bwm_the_conduit.150
	title = "bwm_the_conduit.150"
	desc = "bwm_the_conduit.150.desc"
	picture = GFX_evt_federation_fleet
	show_sound = event_mystic_reveal
	location = event_target:bwm_conduit_fleet_reward_loc
	
	is_triggered_only = yes
	
	trigger = {
		is_ai = no
		has_country_flag = bwm_the_conduit_reward_unlock
		any_owned_planet = {
			has_planet_flag = bwm_conduit_garden
		}
		NOT = {
			check_variable = {
					which = "bwm_conduit_reward_counter"
					value = 3
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				check_variable = {
					which = "bwm_conduit_reward_counter"
					value < 1
				}
			}
			set_variable = {
				which = "bwm_conduit_reward_counter"
				value = 1
			}
			else = {
				change_variable = {
					which = "bwm_conduit_reward_counter"
					value = 1
				}
			}
		}
		if = {
			limit = {
				has_country_flag = bwm_conduit_fleet_1_unlock
			}
			remove_country_flag = bwm_conduit_fleet_1_unlock
		}
		if = {
			limit = {
				has_country_flag = bwm_conduit_fleet_2_unlock
			}
			remove_country_flag = bwm_conduit_fleet_2_unlock
		}
		if = {
			limit = {
				has_country_flag = bwm_conduit_fleet_3_unlock
			}
			remove_country_flag = bwm_conduit_fleet_3_unlock
		}
	}

	option = {
		name = bwm_the_conduit.150.a
		custom_tooltip = bwm_the_conduit.150.a.tooltip
		allow = {
			energy > 1000
			minerals > 1000	
		}
		random_system = {
			limit = {
				has_star_flag = bwm_garden_system 
				}
			random_system_planet = {
				limit = {
					has_planet_flag = bwm_conduit_garden 
				}
				save_event_target_as = bwm_conduit_garden
			}
		}
		hidden_effect = {
			if ={
				limit = {
					NOT = { has_country_flag = bwm_conduit_fleet_choice_1   }
				}
				set_country_flag = bwm_conduit_fleet_choice_1 
			}
		}
		add_energy = -1000
		add_minerals = -1000
		enable_special_project = {
			name = "bwm_CONDUIT_FLEET_1"
			location = event_target:bwm_conduit_garden
			owner = ROOT
		}
	}
	option = {
		name = bwm_the_conduit.150.b
		custom_tooltip = bwm_the_conduit.150.b.tooltip
		allow = {
			energy > 2000
			minerals > 2000
		}
		random_system = {
			limit = {
				has_star_flag = bwm_garden_system 
				}
			random_system_planet = {
				limit = {
					has_planet_flag = bwm_conduit_garden 
					}
				save_event_target_as = bwm_conduit_garden
			}
		}
		hidden_effect = {
			if ={
				limit = {
					NOT = { has_country_flag = bwm_conduit_fleet_choice_2  }
				}
				set_country_flag = bwm_conduit_fleet_choice_2
			}
		}
		add_energy = -2000
		add_minerals = -2000
		enable_special_project = {
			name = "bwm_CONDUIT_FLEET_2"
			location = event_target:bwm_conduit_garden
			owner = ROOT
		}
	}
	option = {
		name = bwm_the_conduit.150.c
		custom_tooltip = bwm_the_conduit.150.c.tooltip
		allow = {
			energy > 3000
			minerals > 3000
		}
		random_system = {
			limit = {
				has_star_flag = bwm_garden_system 
			}
			random_system_planet = {
				limit = { 
					has_planet_flag = bwm_conduit_garden 
				}
				save_event_target_as = bwm_conduit_garden
			}
		}
		hidden_effect = {
			if ={
				limit = {
					NOT = { has_country_flag = bwm_conduit_fleet_choice_3  }
				}
				set_country_flag = bwm_conduit_fleet_choice_3
			}
		}
		add_energy = -3000
		add_minerals = -3000
		enable_special_project = {
			name = "bwm_CONDUIT_FLEET_3"
			location = event_target:bwm_conduit_garden
			owner = ROOT
		}
	}
	option = {
		name = bwm_the_conduit.150.d
		add_influence = 100
	}
}

#Fleet Repair Reward: FLEET 1 (Escort fleet)
ship_event = {
	id = bwm_the_conduit.151
	title = "bwm_the_conduit.151"
	desc = "bwm_the_conduit.151.desc"
	picture = GFX_evt_ship_in_orbit
	show_sound = event_mystic_reveal_light
	location = this
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			is_ai = no
			has_country_flag = bwm_conduit_fleet_choice_1
			NOT = {
				has_country_flag = bwm_conduit_fleet_1_unlock
			}
		}
	}

	immediate = {
		owner = {
			save_event_target_as = bwm_conduit_fleet_owner 
			set_country_flag = bwm_conduit_fleet_1_unlock
			add_threat = {
			who = owner
			amount = 5
			}
		}
	}
	
	option = { 
		name = EXCELLENT
		create_fleet = {
			name = "Eternal Flotilla"
			settings = {
				spawn_debris = no 
			}	
			effect = {
				set_owner = event_target:bwm_conduit_fleet_owner
				while = {
					count = 5
					create_ship = {
						name = "Conduit"
						design = "Nephtys"
						graphical_culture = "fallen_empire_03"
						prefix = no
					}	
				}
				set_location = root
			}
		}
		hidden_effect = {
			owner = {
				country_event = { id = bwm_the_conduit.150 days = 360 }			
			}
		}
	}
	
}

#Fleet Repair Reward: FLEET 2 (Battleship fleet)
ship_event = {
	id = bwm_the_conduit.152
	title = "bwm_the_conduit.152"
	desc = "bwm_the_conduit.152.desc"
	picture = GFX_evt_ship_in_orbit
	show_sound = event_mystic_reveal_light
	location = this
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			is_ai = no
			has_country_flag = bwm_conduit_fleet_choice_2
			NOT = {
				has_country_flag = bwm_conduit_fleet_2_unlock
			}
		}
	}
	
	immediate = {
		owner = {
			save_event_target_as = bwm_conduit_fleet_owner 
			set_country_flag = bwm_conduit_fleet_2_unlock
			add_threat = {
			who = owner
			amount = 5
			}
		}
	}
	
	option = { 
		name = EXCELLENT
		create_fleet = {
			name = "Eternal Flotilla"
			settings = {
				spawn_debris = no 
			}
			effect = {
				set_owner = event_target:bwm_conduit_fleet_owner
				create_ship = {
					name = "Conduit"
					design = "Seth"
					graphical_culture = "fallen_empire_03"
					prefix = no
				}
				while = {
					count = 5
					create_ship = {
						name = "Conduit"
						design = "Nephtys"
						graphical_culture = "fallen_empire_03"
						prefix = no
					}	
				}
				set_location = root
			}
		}
		hidden_effect = {
			owner = {
				country_event = { id = bwm_the_conduit.150 days = 360 }			
			}
		}
	}
}

#Fleet Repair Reward: FLEET 3 (Titan fleet)
ship_event = {
	id = bwm_the_conduit.153
	title = "bwm_the_conduit.153"
	desc = "bwm_the_conduit.153.desc"
	picture = GFX_evt_ship_in_orbit
	show_sound = event_mystic_reveal_light
	location = this
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			is_ai = no
			has_country_flag = bwm_conduit_fleet_choice_3
			NOT = {
				has_country_flag = bwm_conduit_fleet_3_unlock
			}
		}
	}
	
	immediate = {
		owner = {
			save_event_target_as = bwm_conduit_fleet_owner 
			set_country_flag = bwm_conduit_fleet_3_unlock
			add_threat = {
			who = owner
			amount = 5
			}
		}
	}
	
	option = { 
		name = EXCELLENT
		create_fleet = {
			name = "Eternal Flotilla"
			settings = {
				spawn_debris = no 
			}
			effect = {
				set_owner = event_target:bwm_conduit_fleet_owner
				create_ship = {
					name = "Conduit"
					design = "Osiris"
					graphical_culture = "fallen_empire_03"
					prefix = no
				}
				while = {
					count = 5
					create_ship = {
						name = "Conduit"
						design = "Nephtys"
						graphical_culture = "fallen_empire_03"
						prefix = no
					}	
				}
				set_location = root
			}
		}
		hidden_effect = {
			owner = {
				country_event = { id = bwm_the_conduit.150 days = 360 }			
			}
		}
	}
}

country_event = {
	id = bwm_the_conduit.200
	title = "bwm_the_conduit.200"
	desc = "bwm_the_conduit.200.desc"
	picture = GFX_evt_unspeakable_horror

	trigger = {
		is_ai = no
		NOT = {
			has_country_flag = bwm_conduit_limit_break_lock
		}
		has_country_flag = bwm_conduit_evolve_success
		has_country_flag = bwm_conduit_schematic_tech_lock
		any_owned_ship = {
			is_ship_size = bwm_conduit_avatar
		}
	}
	
	mean_time_to_happen = {
		years = 10

		modifier = {
			factor = 0.5
				OR = {
					OR ={
						has_country_flag = bwm_titan_overdrive_unlock 
						has_country_flag = bwm_grave_overdrive_unlock
					}
					OR = {
						has_global_flag = prethoryn_invasion_happened
						has_global_flag = extradimensional_invasion_happened
						has_global_flag = war_in_heaven_started
						has_global_flag = bwm_ancestor_crisis_start
					}
				}
		}
	}
	
	immediate = {
		set_country_flag = bwm_conduit_limit_break_lock
		capital_scope = { save_event_target_as = bwm_pc_home }
	}

	option = {
		name = "bwm_the_conduit.200.a"
		event_target:bwm_pc_home = {
			enable_special_project = {
				name = "bwm_CONDUIT_LIMIT_BREAK"
				location = THIS
				owner = ROOT
			}
		}
	}
	option = {
		name = "bwm_the_conduit.200.b"
		add_influence = 100
	}
}

country_event = {
	id = bwm_the_conduit.201
	title = "bwm_the_conduit.201"
	desc = "bwm_the_conduit.201.desc"
	picture = GFX_evt_ship_in_orbit
	
	is_triggered_only = yes
	
	trigger = {
			is_ai = no
			has_country_flag = bwm_conduit_evolve_success
			has_country_flag = bwm_conduit_schematic_tech_lock
			NOT = {
				has_country_flag = bwm_conduit_overdrive_unlock 
			}
			any_owned_ship = {
				is_ship_size = bwm_conduit_avatar
			}
		}

	option = {
		name = "bwm_the_conduit.201.a"
		custom_tooltip = bwm_the_conduit.201.a.tooltip
		hidden_effect = {
			set_country_flag = bwm_conduit_overdrive_unlock 
		}
	}	
}

fleet_event = {
	id = bwm_the_conduit.202
	hide_window = yes

	trigger = {	
		any_combatant_fleet = {
			exists = owner
			owner = {
				has_country_flag = bwm_conduit_overdrive_unlock 
				NOT = {
					has_country_flag = bwm_conduit_overdrive_cd_flag
				}
			}
			any_owned_ship = {
				is_ship_size = bwm_conduit_avatar
				has_hp_percentage < 0.1
				has_hp_percentage > 0
			}
		}
	}
	
	immediate = {
		random_combatant_fleet = {
			limit = {
				exists = owner
				owner = {
					is_ai = no
					has_country_flag = bwm_conduit_overdrive_unlock 
					NOT = {
						has_country_flag = bwm_conduit_overdrive_cd_flag
					}
				}
				any_owned_ship = {
					is_ship_size = bwm_conduit_avatar
				}
			}
			this = {
				save_event_target_as = bwm_overdrive_fleet_loc
			}
			owner = {
				random_owned_ship = {
					limit = {
						is_ship_size = bwm_conduit_avatar
					}
					repair_ship = yes
					bwm_overdrive = yes
					ship_event = { id = bwm_the_conduit.203 days = 30   }
				}
				country_event = { id = bwm_the_conduit.204 }
				set_timed_country_flag = {
					flag = bwm_conduit_overdrive_cd_flag
					days = 360
				}
			}
		}
	}
}

ship_event = {
	id = bwm_the_conduit.203
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		this = {
			save_event_target_as = bwm_overdrive_cd_loc
		}
		owner = {
			country_event = { id = bwm_the_conduit.205 }
		}
		bwm_overdrive_cd = yes
	}
}

country_event = {
	id = bwm_the_conduit.204
	title = "bwm_the_conduit.204"
	desc = "bwm_the_conduit.204.desc"
	picture = GFX_evt_small_space_battle
	location = event_target:bwm_overdrive_fleet_loc
	
	is_triggered_only = yes

	option = {
		name = "bwm_the_conduit.204.a"
	}
}

country_event = {
	id = bwm_the_conduit.205
	title = "bwm_the_conduit.205"
	desc = "bwm_the_conduit.205.desc"
	picture = GFX_evt_sentient_AI
	location = event_target:bwm_overdrive_cd_loc
	
	is_triggered_only = yes

	option = {
		name = "bwm_the_conduit.205.a"
	}
}
